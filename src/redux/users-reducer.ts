import {Dispatch} from 'redux'import {usersAPI} from '../api/api'import {ACTIONS_TYPE} from './actions'const initialState: UsersStateType = {   users: [],   pageSize: 10,   totalItemsCount: 0,   currentPage: 1,   isFetching: true,   followingInProgress: []}export const usersReducer = (state = initialState, action: ActionsType): UsersStateType => {   switch (action.type) {      case ACTIONS_TYPE.FOLLOW:         return {            ...state,            users: state.users.map(u => {               if (u.id === action.userId) {                  return {...u, followed: true}               }               return u            })         }      case ACTIONS_TYPE.UNFOLLOW:         return {            ...state,            users: state.users.map(user => {               if (user.id === action.userId) {                  return {...user, followed: false}               }               return user            })         }      case ACTIONS_TYPE.SET_USERS: {         return {...state, users: action.users}      }      case ACTIONS_TYPE.SET_CURRENT_PAGE: {         return {...state, currentPage: action.currentPage}      }      case ACTIONS_TYPE.SET_TOTAL_USERS_COUNT: {         return {...state, totalItemsCount: action.totalCount}      }      case ACTIONS_TYPE.TOGGLE_IS_FETCHING: {         return {...state, isFetching: action.isFetching}      }      case ACTIONS_TYPE.TOGGLE_IS_FOLLOWING_PROGRESS: {         return {            ...state,            followingInProgress: action.isFetching               ? [...state.followingInProgress, action.userId]               : state.followingInProgress.filter(id => id !== action.userId)         }      }      default:         return state   }}// actionsexport const followSuccess = (userId: number) => ({type: ACTIONS_TYPE.FOLLOW, userId} as const)export const unfollowSuccess = (userId: number) => ({type: ACTIONS_TYPE.UNFOLLOW, userId} as const)export const setUsers = (users: Array<Usertype>) => ({type: ACTIONS_TYPE.SET_USERS, users} as const)export const setCurrentPage = (currentPage: number) => ({type: ACTIONS_TYPE.SET_CURRENT_PAGE, currentPage} as const)export const setTotalItemsCount = (totalCount: number) =>   ({type: ACTIONS_TYPE.SET_TOTAL_USERS_COUNT, totalCount} as const)export const toggleIsFetching = (isFetching: boolean) => ({type: ACTIONS_TYPE.TOGGLE_IS_FETCHING, isFetching} as const)export const toggleFollowingProgress = (isFetching: boolean, userId: number) =>   ({type: ACTIONS_TYPE.TOGGLE_IS_FOLLOWING_PROGRESS, isFetching, userId} as const)// thunksexport const requestUsers = (page: number, pageSize: number) => async (dispatch: Dispatch) => {   dispatch(toggleIsFetching(true))   dispatch(setCurrentPage(page))   const response = await usersAPI.getUsers(page, pageSize)   dispatch(toggleIsFetching(false))   dispatch(setUsers(response.items))   dispatch(setTotalItemsCount(response.totalCount))}const followUnfollowFlow = async (dispatch: Dispatch, userId: number, apiMethod: any, actionCreator: any) => {   dispatch(toggleFollowingProgress(true, userId))   const response = await apiMethod(userId)   if (response.data.resultCode === 0) {      dispatch(actionCreator(userId))   }   dispatch(toggleFollowingProgress(false, userId))}export const follow = (userId: number) => async (dispatch: Dispatch) => {   await followUnfollowFlow(dispatch, userId, usersAPI.followUser.bind(usersAPI), followSuccess)}export const unfollow = (userId: number) => async (dispatch: Dispatch) => {   await followUnfollowFlow(dispatch, userId, usersAPI.unfollowUser.bind(usersAPI), unfollowSuccess)}// typesexport type UsersStateType = {   users: Array<Usertype>   pageSize: number   totalItemsCount: number   currentPage: number   isFetching: boolean   followingInProgress: any[]}export type Usertype = {   id: number   name: string   status: string   photos: PhotosType   followed: boolean}type PhotosType = {   small: string   large: string}export type ActionsType =   ReturnType<typeof followSuccess>   | ReturnType<typeof unfollowSuccess>   | ReturnType<typeof setUsers>   | ReturnType<typeof setCurrentPage>   | ReturnType<typeof setTotalItemsCount>   | ReturnType<typeof toggleIsFetching>   | ReturnType<typeof toggleFollowingProgress>